# Soccer Video Processing Pipeline

Agent-based system that processes 4K soccer match recordings from a NAS and automatically produces:

- **Goalkeeper Reel** — every GK action (saves, distribution, one-on-ones)
- **Highlights Reel** — shots, goals, near-misses, great plays
- **Player Reel** *(Phase 2)* — on-demand reel for any outfield player

## Quick Start

```bash
# 1. Configure environment
cp infra/.env.example infra/.env
# Edit infra/.env with your NAS paths

# 2. Download ML models
bash infra/models/download_models.sh

# 3. Start the stack
make up

# 4. Submit a match for processing
curl -X POST http://localhost:8080/jobs \
  -H "Content-Type: application/json" \
  -d '{"nas_path": "matches/game_2025_01_15.mp4", "reel_types": ["goalkeeper", "highlights"]}'

# 5. Monitor progress
open http://localhost:5555   # Flower dashboard
```

## Agent System

This project uses Claude Code's multi-agent architecture. Each subdirectory under `agents/` is an independent agent with its own `CLAUDE.md` context:

| Agent | `cd` command | Purpose |
|-------|-------------|---------|
| Architect | `cd agents/architect` | System design, ADRs, interface contracts |
| Developer | `cd agents/developer` | All source code in `src/` |
| SDET | `cd agents/sdet` | Tests, CI, quality gates |
| Video Analyst | `cd agents/video-analyst` | CV/ML models, event taxonomy |
| Pipeline Operator | `cd agents/pipeline-operator` | Infra, deployment, monitoring |

## Development

```bash
make setup              # Install Python deps
make generate-fixtures  # Create synthetic test videos
make test-unit          # Fast tests, no infra needed
make test-integration   # Requires Docker
make check-nas          # Verify NAS connectivity
```

## Architecture

```
NAS (read-only)          Processing Node              NAS (output)
├── matches/             ┌────────────────────┐       ├── output/
│   ├── game1.mp4  ──►  │  Watcher → Intake  │         │   ├── {job_id}/
│   └── game2.mp4        │  ↓                 │         │   │   ├── goalkeeper_reel.mp4
│                         │  Detection         │  ──►   │   │   └── highlights_reel.mp4
│                         │  (YOLO + ByteTrack)│         │   └── ...
│                         │  ↓                 │
│                         │  Segmentation      │
│                         │  ↓                 │
│                         │  Assembly (FFmpeg) │
│                         └────────────────────┘
```

## Key Design Decisions

- **Streaming-first**: Video never fully loaded into RAM
- **Idempotent**: Re-processing same file = identical output
- **GPU-optional**: Runs on CPU (slower); GPU accelerates detection
- **NAS-safe**: Source files never modified

See `docs/architecture.md` (generated by Architect agent) for full design.
